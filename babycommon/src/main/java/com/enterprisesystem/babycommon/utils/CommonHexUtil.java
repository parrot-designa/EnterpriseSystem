package com.enterprisesystem.babycommon.utils;

/**
 * 十六进制编码工具类
 * 用于将字节数组转换为十六进制字符串表示
 */
public class CommonHexUtil {

    /**
     * 十六进制字符数组（小写）
     * 用于将 4 位二进制数（0-15）映射为对应的十六进制字符
     */
    private static final char[] DIGITS_LOWER = new char[]{'0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'};

    /**
     * 将字节数组编码为十六进制字符串（小写）
     *
     * @param data 要编码的字节数组
     * @return 十六进制字符串表示，每个字节转换为 2 个十六进制字符
     *
     * 工作原理：
     * 1. 每个字节（byte）由 8 位二进制组成，范围是 -128 到 127
     * 2. 将每个字节拆分为高 4 位和低 4 位两部分
     * 3. 每 4 位可以表示 0-15 的数值，对应一个十六进制字符（0-9, a-f）
     * 4. 最终每个字节转换为 2 个十六进制字符
     *
     * 示例：
     * - 字节 -1（二进制 11111111）→ "ff"
     * - 字节 10（二进制 00001010）→ "0a"
     * - 字节数组 {10, -1} → "0aff"
     */
    public static String encodeHexString(byte[] data){
        // 获取字节数组长度
        int l = data.length;

        // 创建字符数组，长度为字节数组长度的 2 倍
        // 使用位运算 l << 1 等价于 l * 2，性能更高
        // 因为每个字节需要 2 个十六进制字符表示
        char[] out = new char[l << 1];

        // 用于遍历字节数组的索引
        int i = 0;

        // 遍历字节数组，将每个字节转换为 2 个十六进制字符
        // var4: 输出字符数组的索引
        // i: 输入字节数组的索引
        for(int var4=0;i<l;++i){
            // 处理字节的高 4 位：
            // 1. (240 & data[i]) - 使用位与运算提取高 4 位
            //    240 的二进制是 11110000，与 data[i] 进行与运算后，低 4 位变为 0，高 4 位保留
            // 2. >>> 4 - 无符号右移 4 位，将高 4 位移到低 4 位位置
            // 3. DIGITS_LOWER[...] - 将数值（0-15）映射为对应的十六进制字符
            // 示例：data[i] = -1 (11111111) → 240 & (-1) = 240 (11110000) → 240 >>> 4 = 15 → 'f'
            out[var4++] = DIGITS_LOWER[(240 & data[i]) >>> 4];

            // 处理字节的低 4 位：
            // 1. (15 & data[i]) - 使用位与运算提取低 4 位
            //    15 的二进制是 00001111，与 data[i] 进行与运算后，高 4 位变为 0，低 4 位保留
            // 2. DIGITS_LOWER[...] - 将数值（0-15）映射为对应的十六进制字符
            // 示例：data[i] = -1 (11111111) → 15 & (-1) = 15 (00001111) → 'f'
            out[var4++] = DIGITS_LOWER[15 & data[i]];
        }

        // 将字符数组转换为字符串并返回
        return new String(out);
    }
}
